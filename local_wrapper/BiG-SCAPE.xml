<tool id="big-scape" name="BiG-SCAPE" version="1.1.5+galaxy0" profile="21.05">
       <description> construct sequence similarity networks of BGCs and groups them into GCF</description>
       <requirements>
              <requirement type="package" version="0.0.1">foobar</requirement>
       </requirements>
       <command detect_errors="exit_code">
       <![CDATA[

              mkdir input;
              #for $files in $inputdir:
                     ln -s $files input/$files.element_identifier;
              #end for

              mkdir result;

              mkdir output;

              mkdir pfam;
              ln -s $pfam_dir pfam/$pfam_dir.element_identifier;
              hmmpress pfam/Pfam-A.hmm;

              #if $anchor.is_select == "yes":
                     ln -s $anchorfile $anchorfile.element_identifier;
              #end if
              #if $query.is_select == "yes":
                     ln -s $query_bgc $query_bgc.element_identifier;
              #end if
              #if $list.is_select == "yes":
                     cat $domain_includelist > $__tool_directory__/BiG-SCAPE/domain_includelist.txt;
              #end if

              python3 $__tool_directory__/BiG-SCAPE/bigscape.py 
              --inputdir input
              --outputdir result
              #if $use_label.is_select == "yes":
                     --label ${label}
              #end if
              #if $include_gbk.is_select == "yes":
                     --include_gbk_str ${include_gbk_str}
              #end if
              #if $exclude_gbk.is_select == "yes":
                     --exclude_gbk_str ${exclude_gbk_str}
              #end if
              --pfam_dir pfam
              --core \${GALAXY_SLOTS:-8}
              ${verbose}
              ${include_singletons}
              --domain_overlap_cutoff ${domain_overlap_cutoff}
              --min_bgc_size ${min_big_size}
              ${mix}
              ${no_classify}
              #if $banned_classes.value: 
                     --banned_classes
                     #for $banned in str( $banned_classes).split( "," ):  
                            $banned  
                     #end for
              #end if
              --cutoffs $cutoffs
              ${clans_off}
              #if $clans_cutoff.is_select == "yes":
                     --clans_cutoff $clans_cutoff_val1 $clans_cutoff_val2
              #end if
              ${hybrids_off}
              --mode ${mode.value}
              #if $anchor.is_select == "yes":
                     --anchorfile ${anchorfile.element_identifier}
              #end if
              ${force_hmmscan}
              ${skip_ma}
              #if $mibig.is_select == "yes":
                     $mibig.mibig.value
              #end if
              #if $query.is_select == "yes":
                     --query_bgc ${query_bgc.element_identifier}
              #end if
              #if $list.is_select == "yes":
                     --domain_includelist
              #end if
              ;

              mv result/*.html output;
              mv result/network_files output;
              mv result/html_content output;

              zip -r output.zip output;
       ]]>
       </command>
       <inputs>
              <param argument="--inputdir" format=".gbk" multiple="true" type="data"
                     label="Data files to inlcude in the clustering" 
                     help="Add your .gbk files here" />
              <conditional name="use_label" >
                     <param name="is_select" type="select" label="Adding extra string to BiG-SCAPE runs?"
                            help="Select yes if you want to add an extra string to the outputs">
                            <option value="yes" selected="False"> Yes </option>
                            <option value="no" selected="True"> No </option>
                     </param>
                     <when value="yes">
                            <param argument="--label" type="text" value="" optional="false" label="Adding extra string to BiG-SCAPE runs name"
                                   help="By default the BiG-SCAPE runs are named as (YYYY-MM-DD_HH-MM-SS_[extra]) where extra means the mode and if activated (hybrids).">
                                   <validator type="empty_field" />
                            </param>
                     </when>
                     <when value="no" />
              </conditional>
              <conditional name="include_gbk" >
                     <param name="is_select" type="select" label="Include file(s) with certain string(s)?"
                            help="Select yes if you want to include file(s) with certain string(s)">
                            <option value="yes" selected="False"> Yes </option>
                            <option value="no" selected="True"> No </option>
                     </param>
                     <when value="yes">
                            <param argument="--include_gbk_str" type="text" value="" optional="false" label="Include file(s) who contain followed string(s)"
                                   help="Include file(s) with a space seperated list wherer any of the string(s) are contain in the file(s) name. To use all files just type an asterisk (*), this also overwrite the enclude_gbk_str command!">
                                   <validator type="empty_field" />
                            </param>
                     </when>
                     <when value="no" />
              </conditional>
              <conditional name="exclude_gbk" >
                     <param name="is_select" type="select" label="Exclude file(s) with certain string(s)?"
                            help="Select yes if you want to eclude file(s) with certain string(s)">
                            <option value="yes" selected="False"> Yes </option>
                            <option value="no" selected="True"> No </option>
                     </param>
                     <when value="yes">
                            <param argument="--exclude_gbk_str" type="text" value="" optional="false" label="Exclude file(s) who contain followed string(S)"
                                   help="Exclude file(S) with a space seperated list wherer any of the string(s) are contain in the file(s) name">
                                   <validator type="empty_field" />
                            </param>
                     </when>
                     <when value="no" />
              </conditional>
              <param argument="--pfam_dir" format=".hmm" type="data"
                     label="Data file Pfam-A.hmm"
                     help="Add Pfam-A.hmm file here please. Look at the help section where you can download it!" />
              <param argument="--verbose" type="boolean" truevalue="--verbose" falsevalue="" checked="False"
                     label="Print more detailed information about each step"
                     help="Getting more information about the analysis if toggled is true." />
              <param argument="--include_singletons" type="boolean" truevalue="--include_singletons" falsevalue="" checked="False"
                     label="Include BGCs with lower cutoff distance" 
                     help="With this option you can include BGCs who doesnt have a distance lower then the cutoff distance specified" /> 
              <param argument="--domain_overlap_cutoff" type="float" value="0.1" min="0.0" max="1.0"
                     label="Specify when domains are considered to overlap"
                     help="When using this option you can sprecify at which percentage domains are considered to overlap. Domain with the best score is kept. The default value is 0.1" />
              <param argument="--min_big_size" type="integer" value="0" min="0" 
                     label="Minimum size of a BGC (bp)"
                     help="Minimum size of a BGC to be included in the analysis. The Default value is 0 base pairs. This also inlcudes the sum of all loci in a multi-record GenBandk file." />
              <param argument="--mix" type="boolean" truevalue="--mix" falsevalue="" checked="False"
                     label="mix all classes in the analysis"
                     help="BiG-SCAPE seperates the analysis according to the BGC product by default. If used BiG-SCAPE will mix all classes and analyse them." />
              <param argument="--no_classify" type="boolean" truevalue="--no_classify" falsevalue="" checked="False"
                     label="No classified output based on the BGC product"
                     help="By default, BiG-SCAPE classifies the output based on the BGC product. If toggled it will deactivate it. Note: when (--mix) is not activated, BiG-SCAPE will not create any network file!" />
              <param argument="--banned_classes" type="select" optional="true" multiple="true" display="checkboxes"
                     label="Exluded classes from classification in BiG-SCAPE"
                     help="You can exclude any of this classes to not be classifed. Multipe banned classes are possible." >
                     <option value="PKSI" selected="False">PKSI</option>
                     <option value="PKother" selected="False">PKother</option>
                     <option value="NRPS" selected="False">NRPS</option>
                     <option value="RIPPs" selected="False">RIPPs</option>
                     <option value="Saccharides" selected="False">Saccharides</option>
                     <option value="Terpene" selected="False">Terpene</option>
                     <option value="PKS-NRP_Hybrids" selected="False">PKS-NRP_Hybrids</option>
                     <option value="Others" selected="False">Others</option>
              </param>
              <param argument="--cutoffs" type="text" value="0.3" min="0.0" max="1.0" optional="false"
                     label="GCF cutoff value"
                     help="Generate networks using muliple raw distance cutoffs values. The default value here is 0.3."/>
              <param argument="--clans-off" type="boolean" truevalue="--clans-off" falsevalue="" checked="False"
                     label="Turn off cluster GCFs into GCCs"
                     help="By default, BiG-SCAPE will perform a second layer of clustering to group GCFs into GCCs. Toggle to deactivate this." />
              <conditional name="clans_cutoff" >
                     <param name="is_select" type="select" label="Change cutoff values for cluster GCF into GCC?"
                            help="Select yes if you want to change cutoffs for cluster families into clans.">
                            <option value="yes" selected="False"> Yes </option>
                            <option value="no" selected="True"> No </option>
                     </param>
                     <when value="yes">
                            <param name="clans_cutoff_val1" type="float" value="0.3" min="0.0" max="1.0" label="GCF cutoff value"
                                   help="This value is for finding GCFs which will be used for clan calling. The default value is 0.3." />
                            <param name="clans_cutoff_val2" type="float" value="0.7" min="0.0" max="1.0" label="GCC cutoff value"
                                   help="This value is for clustering families into clans. The default value is 0.7. Every pair of GCFs linked with a distance of this value or less will be taken into account!" />
                     </when>
                     <when value="no" />
              </conditional>
              <param argument="--hybrids_off" type="boolean" truevalue="--hybrids-off" falsevalue="" checked="False"
                     label="Exclude hybrid predicted products"
                     help="By default, BGCs with hybrid predicted products from the PKS/NRPS Hybrids and Others classes will be included into each subclass. Since it can happen that the same cluster may appear in different classes you can turn this off here." />
              <param argument="--mode" type="select"
                     label="Alignment Mode"
                     help="Here you can choose between 3 Alignment Mode which are used in comparing each pair of gene cluters. glocal is the default mode." >
                     <option value="glocal">
                     glocal
                     </option>
                     <option value="global">
                     global
                     </option>
                     <option value="auto">
                     auto
                     </option>
              </param>
              <conditional name="anchor">
                     <param name="is_select" type="select" label="Change Anchorfile?"
                            help="Select yes if you want to use an Anchorfile. BiG-SCAPE has a default file which always be used." >
                            <option value="yes" selected="False"> Yes </option>
                            <option value="no" selected="True"> No </option>
                     </param>
                     <when value="yes">
                            <param argument="--anchorfile" type="data" format=".txt" optional="false"
                                   label="using a different anchorfile instead of default file"
                                   help="Use a custom anchorfile (in .txt format) to give certain domains a special weight in the DSS index." />
                     </when>
                     <when value="no" />
              </conditional>
              <param argument="--force_hmmscan" type="boolean" truevalue="--force_hmmscan" falsevalue="" checked="False"
                     label="Use hmmscan for the domain predicition"
                     help="Even if BiG-SCAPE finds poreccessed domtables files we can force the domain prediciton with hmmscan. Toggle to force hmmscan!" />
              <param argument="--skip_ma" type="boolean" truevalue="--skip_ma" falsevalue="" checked="False"
                     label="Skip multiple alignment of domains sequences"
                     help="Use if alignments have been generated in a previous run. Domain sequence alignment will also be skipped if BiG-SCAPE reutilizes an output directory." />
              <conditional name="mibig">
                     <param name="is_select" type="select" label="Include BGCs from MIBiG database?"
                            help="Select yes and select which version of the database you want to use" >
                            <option value="yes" selected="False"> Yes </option>
                            <option value="no" selected="True"> No </option>
                     </param>
                     <when value="yes">
                            <param name="mibig" type="select" optional="false" label="Version from the MIBiG database"
                                   help="Select which version of the MIBiG databse you want to use." >
                                   <option value="--mibig"> 3.1 </option>
                                   <option value="--mibig21"> 2.1 </option>
                                   <option value="--mibig14"> 1.4 </option>
                                   <option value="--mibig13"> 1.3 </option>
                            </param>
                     </when>
                     <when value="no" />
              </conditional>
              <conditional name="query">
                     <param name="is_select" type="select" label="Compare a diffrent genbank file with all BGCs?"
                            help="Select yes if you want to use a .gbk file to compare with all other BGCs">
                            <option value="yes" selected="False"> Yes </option>
                            <option value="no" selected="True"> No </option>
                     </param>
                     <when value="yes">
                            <param argument="--query_bgc" type="data" format=".gbk" optional="false"
                                   label="using a BGC to compare with all other BGC"
                                   help="Change the mode from all-VS-all to one-VS-all. The BGC which is choose here will be compare to all other BGCs." />
                     </when>
                     <when value="no" />
              </conditional>
              <conditional name="list">
                     <param name="is_select" type="select" label="Use a domain list to include domains?"
                            help="Select yes if you want to use a list to include domains">
                            <option value="yes" selected="False"> Yes </option>
                            <option value="no" selected="True"> No </option>
                     </param>
                     <when value="yes">
                            <param argument="--domain_includelist" type="data" format=".txt" optional="false"
                                   label="Use a .txt file to include domains"
                                   help="Upload a text file where the domains will be added to the run. Looking at the help section to see an example!" />
                     </when>
                     <when value="no" />
              </conditional>
              </inputs>
       <outputs>
              <data name="output" label="graphical_and_network_output : ${tool.name}" from_work_dir="output.zip" format="zip" />
       </outputs>
       <tests>
              <test expect_num_outputs="1">
                     <param name="pfam_dir" value="Pfam-A.hmm" ftype="hmm3"/>
                     <param name="inputdir" value="GCF_000011105.1.gbk,GCF_008000775.1.gbk" ftype="genbank" />
                     <conditional name="include_gbk">
                            <param name="is_select" value="yes"/>
                            <param name="include_gbk_str" value="G"/>
                     </conditional>
              </test>
       </tests>
       <help>
       <![CDATA[
              # TODO: Wrote this section befor upload the tool!
       ]]>
       </help>
       <citations>
              <citation type="doi">10.1038/s41589-019-0400-9</citation>
       </citations>
</tool>